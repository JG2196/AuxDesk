@using Data;
@using AuxDeskServices;

@page "/recycle"

<h3>Recycle</h3>

<div class="row gx-3">
    <div class="col-sm-6">
        <div class="p-2">
            <h5><b>Deleted Tasks</b></h5>
            <div class="row row-cols-2">
            @foreach (UserTask userTask in listUsersDeletedTasks)
            {
                
                <div class="col">
                    <div class="card" style="margin-top:8px">
                        <div class="card-body">
                            <div class="row">
                                <div class="col" @onclick="() => SelectTask(userTask.TaskGUID)">
                                    <h6 class="card-title"><b>@userTask.UserTaskData.Title</b></h6>
                                </div>
                                <div class="col" >
                                    @if (userTask.Priority == 1) {
                                        <p class="text-center fw-semibold" style="background-color:red;border-radius:4px">High</p>
                                    }
                                    @if (userTask.Priority == 2)
                                    {
                                        <p class="text-center fw-semibold" style="background-color:orange;border-radius:4px">Medium</p>
                                    }
                                    @if (userTask.Priority == 3)
                                    {
                                        <p class="text-center fw-semibold" style="background-color:green;border-radius:4px">Low</p>
                                    }
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <div class="btn-toolbar" role="toolbar">
                                        <div class="btn-group">
                                            <button type="button" class="btn btn-primary">Open</button>
                                        </div>
                                        <div class="btn-group" style="padding-left:8px">
                                            <button type="button" class="btn btn-danger" @onclick="() => RestoreTask(userTask.TaskGUID)">Restore</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
               
            }
             </div>
        </div>
    </div>
    <div class="col-sm-6">
        <div class="p-2">
            <h5><b>Selected Task</b></h5>
            <div class="input-group mb-3">
                <input type="text" class="form-control" placeholder="Title..." value="@selectedTask.UserTaskData.Title" disabled>
                <div class="dropdown">
                    <button class="btn btn-outline-secondary dropdown-toggle" @onclick="ToggleDropdownPriority" type="button">
                        @selectedPriority
                    </button>
                    <ul class="dropdown-menu @(isDropdownOpenPriorty ? "show" : "")" style="@(isDropdownOpenPriorty ? "position: absolute; inset: 0px auto auto 0px; margin: 0px; transform: translate3d(0px, 40px, 0px);" : "")">
                        <li><a class="dropdown-item" @onclick="@(() => SelectPriority(1))">High</a></li>
                        <li><a class="dropdown-item" @onclick="@(() => SelectPriority(2))">Medium</a></li>
                        <li><a class="dropdown-item" @onclick="@(() => SelectPriority(3))">Low</a></li>
                    </ul>
                </div>
            </div>
            <div class="input-group mb-3  text-center">
                <span class="input-group-text" id="inputGroup-sizing-default">Date</span>
                <input type="date" class="form-control" aria-label="Sizing example input" value="@selectedTask.AssignedDate.ToString("yyyy-MM-dd")" aria-describedby="inputGroup-sizing-default">
            </div>
            <div class="input-group" style="height:60vh">
                <textarea class="form-control" aria-label="With textarea" placeholder="Notes">@selectedTask.UserTaskData.Notes</textarea>
            </div>
        </div>
    </div>
</div>

@code {
    private List<UserTask> listUsersDeletedTasks = new List<UserTask>();
    private UserTask selectedTask = new UserTask();

    private bool isDropdownOpenPriorty = false;
    private string selectedPriority = "Medium";
    private int taskPriority = 2;

    protected override void OnInitialized()
    {
        AuxDeskServices _auxDeskServices = new AuxDeskServices();

        List<DeletedTask> listDeletedTasks = _auxDeskServices.GetDeletedTasks();

        if (listDeletedTasks.Count == 0)
        {
            return;
        }

        List<UserTask> listUserTasks = _auxDeskServices.GetUserTasks();

        foreach (DeletedTask deletedTask in listDeletedTasks)
        {
            UserTask selectedTask = listUserTasks.FirstOrDefault(userTask => userTask.TaskGUID == deletedTask.TaskGUID);
            if (selectedTask != null)
            {
                listUsersDeletedTasks.Add(selectedTask);
            }
        }
    }
    private void ToggleDropdownPriority()
    {
        isDropdownOpenPriorty = !isDropdownOpenPriorty;
    }
    private void SelectPriority(int priority)
    {
        taskPriority = priority;
        isDropdownOpenPriorty = false;
        selectedPriority = "Low";

        if (priority == 1) { selectedPriority = "High"; }
        else if (priority == 2) { selectedPriority = "Medium"; }
    }
    private void RestoreTask(string taskGUID)
    {
        
    }
    private void SelectTask(string taskGUID)
    {
        selectedTask = listUsersDeletedTasks.FirstOrDefault(task => task.TaskGUID == taskGUID);
    }
}
